#include <stdio.h>
#include <sys/mman.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdint.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

#include "exploit.h"

// Pointer to MMIO
uint8_t* mmio;

int main(void) {
    uint64_t rc;

    // Enable Bus Master mode to allow the PCI device to initiate its own DMA
    // if needed (for example, when fetching transmit descriptors from the
    // guest in network devices).
    enable_bus_master_mode();

    // Map the MMIO. Find the address using `lspci` or `lshw`. 
    //
    // Alternatively, you can also find the address through the PCI device's 
    // `resource` file within sysfs, similar to how we accessed the PCI
    // configuration space above in `enable_bus_master_mode`.
    mmio = map_phy_address(0xfebf1000, 0x1000);
    
    if (mmio == MAP_FAILED) {
        printf("[!] Could not map MMIO!\n");
        exit(-1);
    }

    // Now you can read and write into the device's MMIO region
    //write4(0, 1);
}
